<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Jumping Dragon üêâ</title>
<style>
  html,body{height:100%; margin:0; background:#0b0f16; color:#eef3ff; font:16px/1.3 system-ui, -apple-system, Segoe UI, Roboto;}
  .wrap{display:grid; place-items:center; height:100%;}
  .hud{position:fixed; top:12px; left:12px; right:12px; display:flex; justify-content:space-between; gap:10px; pointer-events:none}
  .pill{background:#0e1b2eaa; border:1px solid #1e335acc; padding:8px 12px; border-radius:999px; font-weight:700; backdrop-filter: blur(4px);}
  canvas{background:linear-gradient(180deg,#142036,#0b1424 52%, #203a18 52%, #203a18 56%, #162b10 56%); border:2px solid #1a2a48; border-radius:14px; box-shadow: 0 12px 40px rgba(0,0,0,.5);}
  .btn{position:fixed; bottom:16px; left:50%; transform:translateX(-50%); background:#2df3a2; color:#07261a; border:none; font-weight:800; padding:10px 16px; border-radius:12px; box-shadow:0 10px 24px rgba(45,243,162,.3)}
  .help{position:fixed; bottom:16px; right:16px; color:#9db7e5; font-size:12px; opacity:.9}
</style>
</head>
<body>
<div class="wrap">
  <canvas id="game" width="960" height="320"></canvas>
  <div class="hud">
    <div class="pill" id="score">Score: 0</div>
    <div class="pill" id="hi">Best: 0</div>
  </div>
  <button class="btn" id="start">Tap/Space to Jump ‚Äî Double jump enabled</button>
  <div class="help">ESC: pause ‚Ä¢ R: restart</div>
</div>

<script>
// --- CONFIG ---
const W = 960, H = 320;
const GROUND_Y = 240;
const SCALE = 0.75;
const GRAVITY = 0.0019;
const JUMP_V = -0.73;
const DOUBLE_V = -0.64;
const MAX_SPEED = 0.62;
const START_SPEED = 0.38;
const OBST_MIN = 700;
const OBST_MAX = 1300;
const CLOUD_SLOW = 0.12;

// --- STATE ---
let ctx, canvas, raf, running=false, paused=false;
let last=0, speed=START_SPEED;
let score=0, best=Number(localStorage.getItem("jd_best")||0);
let distToNext=900;
let dragon, obstacles=[], clouds=[];

// --- UTIL ---
function rand(a,b){ return Math.random()*(b-a)+a; }
function clamp(v,a,b){ return Math.min(b, Math.max(a,v)); }

// --- CLASSES ---
class Dragon {
  constructor(img){
    this.img=img;
    this.w=96*SCALE; this.h=96*SCALE;
    this.x=120; this.y=GROUND_Y - this.h;
    this.vy=0; this.onGround=true; this.doubleReady=true;
    this.rot=0;
  }
  reset(){
    this.x=120; this.y=GROUND_Y - this.h; this.vy=0;
    this.onGround=true; this.doubleReady=true; this.rot=0;
  }
  jump(force){
    if(this.onGround){ this.vy = JUMP_V * (force||1); this.onGround=false; this.doubleReady=true; ping(720); }
    else if(this.doubleReady){ this.vy = DOUBLE_V; this.doubleReady=false; ping(820); }
  }
  update(dt){
    this.vy += GRAVITY*dt;
    this.y += this.vy*dt;
    if(this.y >= GROUND_Y - this.h){ this.y = GROUND_Y - this.h; this.vy=0; this.onGround=true; }
    this.rot = clamp(this.vy*0.6, -0.35, 0.35);
  }
  draw(){
    ctx.save();
    ctx.translate(this.x+this.w/2, this.y+this.h/2);
    ctx.rotate(this.rot);
    ctx.drawImage(this.img, -this.w/2, -this.h/2, this.w, this.h);
    ctx.restore();
  }
  hitbox(){
    return {x:this.x+8, y:this.y+6, w:this.w-16, h:this.h-12};
  }
}

class Obstacle {
  constructor(kind){
    this.kind=kind;
    this.w = kind===2? 56: (kind===3? 70: 46);
    this.h = kind===2? 38: (kind===3? 44: 42);
    this.x = W + rand(0, 40);
    this.y = GROUND_Y - this.h;
  }
  update(dt){ this.x -= speed*dt; }
  draw(){
    ctx.fillStyle = "#2cf39a";
    if(this.kind===1) ctx.fillRect(this.x,this.y,this.w,this.h);
    if(this.kind===2) drawSpike(this.x,this.y,this.w,this.h);
    if(this.kind===3) drawLog(this.x,this.y,this.w,this.h);
  }
  hitbox(){ return {x:this.x+4,y:this.y+4,w:this.w-8,h:this.h-6}; }
}

class Cloud {
  constructor(){
    this.x = rand(0,W); this.y = rand(30,110);
    this.v = CLOUD_SLOW * rand(0.7,1.3);
    this.s = rand(30,70);
  }
  update(dt){ this.x -= this.v*dt; if(this.x<-this.s){ this.x=W+this.s; this.y=rand(30,110); } }
  draw(){ ctx.fillStyle = "#9db7e566"; drawCloud(this.x, this.y, this.s); }
}

// --- DRAW HELPERS ---
function drawGround(){
  ctx.fillStyle="#1a3112"; ctx.fillRect(0,GROUND_Y, W, H-GROUND_Y);
  ctx.fillStyle="#24461a"; for(let x=-((Date.now()/12)%32); x<W; x+=32) ctx.fillRect(x,GROUND_Y, 18, 6);
}
function drawSpike(x,y,w,h){
  const n=5; ctx.beginPath();
  for(let i=0;i<=n;i++){ const px=x + (i/n)*w; const py= i%2? y+h : y; if(i==0) ctx.moveTo(px,py); else ctx.lineTo(px,py);}
  ctx.closePath(); ctx.fill();
}
function drawLog(x,y,w,h){ ctx.fillRect(x,y+h-10,w,10); ctx.fillRect(x+6,y+6,w-12,h-16); }
function drawCloud(x,y,s){
  ctx.beginPath();
  ctx.arc(x,y,s*0.5,0,Math.PI*2);
  ctx.arc(x+s*0.4,y+6,s*0.36,0,Math.PI*2);
  ctx.arc(x-s*0.35,y+8,s*0.32,0,Math.PI*2);
  ctx.fill();
}

// --- AUDIO ---
let ac; function ensureAC(){ if(!ac) ac = new (window.AudioContext||window.webkitAudioContext)(); }
function ping(freq=600, dur=0.05, type="square"){ if(!ac) return; const o=ac.createOscillator(), g=ac.createGain(); o.type=type; o.frequency.value=freq; g.gain.value=0.06; o.connect(g).connect(ac.destination); o.start(); o.stop(ac.currentTime+dur);}
function boom(){ if(!ac) return; const o=ac.createOscillator(), g=ac.createGain(); o.type="sawtooth"; o.frequency.value=120; g.gain.value=0.2; o.connect(g).connect(ac.destination); o.start(); g.gain.exponentialRampToValueAtTime(0.0001, ac.currentTime+0.25); o.stop(ac.currentTime+0.26);}

// --- CORE LOOP ---
function reset(){ obstacles.length=0; clouds.length=0; for(let i=0;i<6;i++) clouds.push(new Cloud()); speed=START_SPEED; score=0; distToNext=rand(OBST_MIN,OBST_MAX); dragon.reset(); }
function spawnObstacle(){ const kind = Math.random()<0.35?2 : (Math.random()<0.55?3:1); obstacles.push(new Obstacle(kind)); distToNext = rand(OBST_MIN, OBST_MAX) * (0.92 - Math.min(0.28, speed*0.3)); }
function update(dt){
  speed = Math.min(MAX_SPEED, speed + dt*0.0000015);
  score += dt*0.01 * (1 + speed*0.8);
  document.getElementById('score').textContent = 'Score: ' + Math.floor(score);
  document.getElementById('hi').textContent = 'Best: ' + Math.floor(best);
  clouds.forEach(c=>c.update(dt));
  dragon.update(dt);
  distToNext -= speed*dt;
  if(distToNext<=0) spawnObstacle();
  for(const o of obstacles) o.update(dt);
  while(obstacles.length && obstacles[0].x + obstacles[0].w < -10) obstacles.shift();
  const a=dragon.hitbox();
  for(const o of obstacles){
    const b=o.hitbox();
    if(a.x < b.x+b.w && a.x+a.w > b.x && a.y < b.y+b.h && a.y+a.h > b.y) return gameOver();
  }
}
function draw(){
  ctx.clearRect(0,0,W,H);
  clouds.forEach(c=>c.draw());
  drawGround();
  obstacles.forEach(o=>o.draw());
  dragon.draw();
}
function frame(t){
  if(!running || paused) return;
  if(!last) last=t; const dt = Math.min(32, t-last); last=t;
  update(dt); draw(); raf = requestAnimationFrame(frame);
}

function gameOver(){
  boom();
  running=false; cancelAnimationFrame(raf);
  best = Math.max(best, Math.floor(score)); localStorage.setItem('jd_best', best);
  banner('Game Over ‚Äî press R to restart');
}

function banner(text){
  const btn = document.getElementById('start');
  btn.textContent = text;
  btn.style.display = 'block';
}
function hideBanner(){
  const btn = document.getElementById('start');
  btn.style.display='none';
}

// --- INPUT ---
function onPress(){ dragon && dragon.jump(1); ensureAC(); }
document.addEventListener('keydown', (e)=>{
  if(e.code==='Space'){ e.preventDefault(); if(!running) start(); else if(!paused) onPress(); }
  else if(e.code==='ArrowUp' || e.code==='KeyW'){ onPress(); }
  else if(e.code==='KeyR'){ start(); }
  else if(e.code==='Escape'){
    if(running){ paused=!paused; if(!paused){ last=0; raf=requestAnimationFrame(frame); hideBanner(); } else banner('Paused ‚Äî press ESC to resume'); }
  }
});
document.addEventListener('pointerdown', ()=>{ if(!running) start(); else if(!paused) onPress(); });

// --- BOOT ---
window.addEventListener('load', ()=>{
  canvas = document.getElementById('game');
  ctx = canvas.getContext('2d');
  const img = new Image();
  img.onload = ()=>{ dragon = new Dragon(img); reset(); draw(); };
  img.src = "assets/jumping-dragon.png"; // Load from assets folder
  document.getElementById('start').addEventListener('click', ()=>{ if(!running) start(); });
});

function start(){
  reset(); running=true; paused=false; last=0; hideBanner(); raf=requestAnimationFrame(frame);
}
</script>
</body>
</html>
